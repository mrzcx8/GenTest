<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jana Resit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Jana Resit</h1>
            <p class="text-gray-600">Buat dan muat turun resi pembayaran dengan mudah.</p>
        </div>

        <!-- Form Input -->
        <div class="bg-white p-6 rounded-lg shadow-lg max-w-md mx-auto">
            <div class="space-y-4">
                <!-- Upload Logo -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Logo Syarikat</label>
                    <input type="file" id="logoUpload" accept="image/*" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                </div>

                <!-- Nama Pelanggan -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Nama Pelanggan</label>
                    <input type="text" id="customerName" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" placeholder="Masukkan Nama">
                </div>

                <!-- No. Telefon Pelanggan -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">No. Telefon Pelanggan</label>
                    <input type="text" id="customerPhone" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" placeholder="Masukkan No. Telefon">
                </div>

                <!-- Nomor Bill -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">No. Bill</label>
                    <input type="text" id="billNumber" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" placeholder="Masukkan No. Bill">
                </div>

                <!-- Mata Wang -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Mata Wang</label>
                    <select id="currency" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                        <option value="RM">RM (Ringgit Malaysia)</option>
                        <option value="USD">USD (Dolar Amerika)</option>
                        <option value="SGD">SGD (Dolar Singapura)</option>
                    </select>
                </div>

                <!-- Item dan Harga -->
                <div id="itemList" class="space-y-2">
                    <div class="flex space-x-2">
                        <input type="text" placeholder="Nama Item" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                        <input type="number" placeholder="Harga" class="w-1/3 px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                    </div>
                </div>
                <button onclick="addItem()" class="w-full bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300">Tambah Item</button>

                <!-- Diskaun -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Diskaun (%)</label>
                    <input type="number" id="discount" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" placeholder="Masukkan Diskaun">
                </div>

                <!-- GST/SST -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">GST/SST (%)</label>
                    <input type="number" id="tax" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" placeholder="Masukkan GST/SST">
                </div>

                <!-- Status Pembayaran -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Status Pembayaran</label>
                    <select id="paymentStatus" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                        <option value="Pending">Pending</option>
                        <option value="Complete">Complete</option>
                    </select>
                </div>

                <!-- Tarikh -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Tarikh</label>
                    <input type="date" id="date" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                </div>

                <!-- Upload QR Code -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">QR Code (Opsional)</label>
                    <input type="file" id="qrUpload" accept="image/*" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                </div>

                <!-- Tandatangan Digital -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Tandatangan Digital</label>
                    <canvas id="signaturePad" class="w-full h-32 border border-gray-300 rounded-md shadow-sm"></canvas>
                    <button onclick="clearSignature()" class="mt-2 w-full bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300">Padam Tandatangan</button>
                </div>
            </div>

            <!-- Tombol Jana Resit dan Muat Turun PDF -->
            <button onclick="generateReceipt()" class="mt-6 w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600">Jana Resit</button>
            <button onclick="downloadPDF()" class="mt-4 w-full bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600">Muat Turun PDF</button>
            <button onclick="sendWhatsApp()" class="mt-4 w-full bg-teal-500 text-white py-2 px-4 rounded-md hover:bg-teal-600">Hantar ke WhatsApp</button>
        </div>

        <!-- Resi yang Dihasilkan -->
        <div id="receipt" class="bg-white p-6 rounded-lg shadow-lg max-w-md mx-auto mt-8 hidden">
            <div class="text-center">
                <img id="receiptLogo" src="" alt="Logo" class="w-20 h-20 mx-auto mb-4">
                <h1 class="text-2xl font-bold">Resit Pembayaran</h1>
                <p class="text-sm text-gray-500">Terima kasih atas pembayaran anda!</p>
            </div>
            <div class="mt-6">
                <table class="w-full">
                    <tr>
                        <td class="py-2"><strong>No. Bill:</strong></td>
                        <td class="py-2" id="receiptBillNumber"></td>
                    </tr>
                    <tr>
                        <td class="py-2"><strong>Nama Pelanggan:</strong></td>
                        <td class="py-2" id="receiptCustomerName"></td>
                    </tr>
                    <tr>
                        <td class="py-2"><strong>Jumlah Bayaran:</strong></td>
                        <td class="py-2" id="receiptAmount"></td>
                    </tr>
                    <tr>
                        <td class="py-2"><strong>Diskaun:</strong></td>
                        <td class="py-2" id="receiptDiscount"></td>
                    </tr>
                    <tr>
                        <td class="py-2"><strong>GST/SST:</strong></td>
                        <td class="py-2" id="receiptTax"></td>
                    </tr>
                    <tr>
                        <td class="py-2"><strong>Status Pembayaran:</strong></td>
                        <td class="py-2" id="receiptPaymentStatus"></td>
                    </tr>
                    <tr>
                        <td class="py-2"><strong>Tarikh:</strong></td>
                        <td class="py-2" id="receiptDate"></td>
                    </tr>
                </table>
                <!-- Item dan Harga -->
                <div id="receiptItems" class="mt-4"></div>
            </div>
            <div id="qrcode" class="mt-4 flex justify-center">
                <img id="customQR" src="" alt="QR Code" class="hidden">
            </div>
            <div id="signatureImage" class="mt-4 flex justify-center"></div>
        </div>
    </div>

    <script>
        // Fungsi untuk menambah item
        function addItem() {
            const itemList = document.getElementById('itemList');
            const newItem = `
                <div class="flex space-x-2">
                    <input type="text" placeholder="Nama Item" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                    <input type="number" placeholder="Harga" class="w-1/3 px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                </div>
            `;
            itemList.insertAdjacentHTML('beforeend', newItem);
        }

        // Fungsi untuk menghitung total
        function calculateTotal() {
            const items = document.querySelectorAll('#itemList input[type="number"]');
            let total = 0;
            items.forEach(item => {
                total += parseFloat(item.value) || 0;
            });

            const discount = parseFloat(document.getElementById('discount').value) || 0;
            const tax = parseFloat(document.getElementById('tax').value) || 0;

            total = total - (total * (discount / 100));
            total = total + (total * (tax / 100));

            return total;
        }

        // Fungsi untuk menghasilkan resi
        function generateReceipt() {
            const customerName = document.getElementById('customerName').value;
            const billNumber = document.getElementById('billNumber').value;
            const currency = document.getElementById('currency').value;
            const date = document.getElementById('date').value;
            const discount = parseFloat(document.getElementById('discount').value) || 0;
            const tax = parseFloat(document.getElementById('tax').value) || 0;
            const paymentStatus = document.getElementById('paymentStatus').value;
            const total = calculateTotal();

            if (!customerName || !billNumber || !date || total <= 0) {
                alert("Sila isi semua maklumat dengan betul!");
                return;
            }

            // Tampilkan resi
            document.getElementById('receipt').classList.remove('hidden');
            document.getElementById('receiptCustomerName').textContent = customerName;
            document.getElementById('receiptBillNumber').textContent = billNumber;
            document.getElementById('receiptAmount').textContent = `${currency} ${total.toFixed(2)}`;
            document.getElementById('receiptDiscount').textContent = `${discount}%`;
            document.getElementById('receiptTax').textContent = `${tax}%`;
            document.getElementById('receiptPaymentStatus').textContent = paymentStatus;
            document.getElementById('receiptDate').textContent = date;

            // Tampilkan item dan harga
            const items = document.querySelectorAll('#itemList input[type="text"]');
            const prices = document.querySelectorAll('#itemList input[type="number"]');
            let itemsHTML = '<h3 class="text-lg font-bold mt-4">Item dan Harga</h3>';
            items.forEach((item, index) => {
                itemsHTML += `
                    <div class="flex justify-between">
                        <span>${item.value}</span>
                        <span>${currency} ${prices[index].value}</span>
                    </div>
                `;
            });
            document.getElementById('receiptItems').innerHTML = itemsHTML;

            // Tampilkan logo yang diupload
            const logoUpload = document.getElementById('logoUpload');
            if (logoUpload.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('receiptLogo').src = e.target.result;
                };
                reader.readAsDataURL(logoUpload.files[0]);
            }

            // Tampilkan QR code yang diupload
            const qrUpload = document.getElementById('qrUpload');
            if (qrUpload.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('customQR').src = e.target.result;
                    document.getElementById('customQR').classList.remove('hidden');
                };
                reader.readAsDataURL(qrUpload.files[0]);
            } else {
                // Hasilkan QR code otomatis jika tidak ada upload
                const qrData = `No. Bill: ${billNumber}, Nama: ${customerName}, Jumlah: ${currency} ${total.toFixed(2)}, Tarikh: ${date}`;
                document.getElementById('qrcode').innerHTML = '';
                new QRCode(document.getElementById("qrcode"), qrData);
            }

            // Tampilkan tandatangan digital
            const signaturePad = new SignaturePad(document.getElementById('signaturePad'));
            if (!signaturePad.isEmpty()) {
                const signature = signaturePad.toDataURL();
                document.getElementById('signatureImage').innerHTML = `<img src="${signature}" alt="Tandatangan" class="w-32 h-16">`;
            }
        }

        // Fungsi untuk muat turun PDF
        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const receiptElement = document.getElementById('receipt');
            doc.html(receiptElement, {
                callback: function (doc) {
                    doc.save('Resit.pdf');
                },
                x: 10,
                y: 10,
                width: 180,
                windowWidth: receiptElement.clientWidth
            });
        }

        // Fungsi untuk hantar ke WhatsApp
        function sendWhatsApp() {
            const customerPhone = document.getElementById('customerPhone').value;
            if (!customerPhone) {
                alert("Sila masukkan nombor telefon pelanggan!");
                return;
            }

            const receiptData = {
                customerName: document.getElementById('customerName').value,
                billNumber: document.getElementById('billNumber').value,
                amount: calculateTotal(),
                date: document.getElementById('date').value,
            };

            const message = `Resit Pembayaran\nNama: ${receiptData.customerName}\nNo. Bill: ${receiptData.billNumber}\nJumlah: RM ${receiptData.amount.toFixed(2)}\nTarikh: ${receiptData.date}`;
            const url = `https://wa.me/${customerPhone}?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }

        // Fungsi untuk padam tandatangan
        function clearSignature() {
            const signaturePad = new SignaturePad(document.getElementById('signaturePad'));
            signaturePad.clear();
        }
    </script>
</body>
</html>
